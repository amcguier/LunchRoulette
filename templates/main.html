<!DOCTYPE html>
<html>
<head>
	<title>Lunch Roulette</title>
	<link href="static/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>
<body>
	<div>
		<form id="numLS">
			<p><b>Please enter the number of participants for new lunch set and the date:</b></p>
			<p><b>Note: Submitting 0 for the new size will clear the current lunch set</b><p>
			<label class="control-label" for="numLS"></label>
			<input type="number" id="numInNewLS" placeholder="Size of new lunch set"/>
			<input type="date" id="lsDate" placeholder="When is the lunch?"/>
			<button class="btn btn-large btn-primary" type="type">Confirm</button>
		</form>
	</div>
	<div id="forTemplate"></div>
	<div>
		<a href="http://localhost:5000/add">Add Member to Database</a>
		<p><a href="http://localhost:5000/remove">Remove Member from Database</a></p>
	</div>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
	<script src="static/js/bootstrap.min.js"></script>
	<script src="static/js/mustache.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
		genTemp();
		var numForm = $("#numLS")
		numForm.submit(function(evt){
			evt.preventDefault();
			$.post('/newLS',{"num":$('#numInNewLS').val()},function(msg){
				if(!msg){alert("Invalid input");}
				numForm[0].reset()
				location.reload()
			})
		})
	})
	function replaceFun(email){
		$.post('/toSkip',{"email":email},function(msg){
			if(!msg){alert("No valid replacements found.  Entry removed");}
			location.reload();
		})
	}
	function genTemp(){
		$.get('/ls',function(data){
			$("#forTemplate").empty();
			var html = Mustache.render($("#lsTemplate").text(),data);
			$("#forTemplate").append(html);
		})
	}
	</script>
	
	<script id="lsTemplate" type="text/template">
		<p><b>Current Lunch Set</b></p>
		<table border='1'>
		<tr><td>First Name</td><td>Last Name</td><td>Email Address</td><td>Cannot attend?</td></tr>
		{{#lunchset}}
			<tr>
			<td>{{first}}</td>
			<td>{{last}}</td>
			<td>{{email}}</td>
			<td><button class="btn btn-primary" type="type" onclick="replaceFun('{{email}}')">Replace</button></td>
		</tr>
		{{/lunchset}}
		</table>
	</script>
</body>
</html>